<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistics - My Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <button id="backBtn" class="flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Home
            </button>
            <div class="text-center">
                <h1 class="text-3xl font-light text-gray-800 dark:text-gray-100">Journal Insights</h1>
                <p class="text-gray-600 dark:text-gray-400 text-sm">Your personal analytics powered by AI</p>
            </div>
            <div class="w-32"></div>
        </div>

        <!-- AI-Generated Insights Summary -->
        <div class="bg-gradient-to-r from-purple-500 to-blue-600 dark:from-purple-600 dark:to-blue-700 rounded-lg shadow-lg p-6 mb-8 text-white">
            <h2 class="text-2xl font-bold mb-4">üß† AI Journal Insights</h2>
            <div id="aiInsights" class="text-lg opacity-90">
                <!-- AI insights will be populated here -->
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 text-center">
                <div class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="totalEntries">0</div>
                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Journal Entries</div>
                <div class="text-xs text-gray-500 dark:text-gray-500 mt-1" id="entriesThisMonth">0 this month</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 text-center">
                <div class="text-3xl font-bold text-green-600 dark:text-green-400" id="streakDays">0</div>
                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Current Streak</div>
                <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">days writing</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 text-center">
                <div class="text-3xl font-bold text-orange-600 dark:text-orange-400" id="averageMood">üòä</div>
                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Average Mood</div>
                <div class="text-xs text-gray-500 dark:text-gray-500 mt-1" id="moodTrend">‚ÜóÔ∏è improving</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 text-center">
                <div class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="totalWords">0</div>
                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Total Words</div>
                <div class="text-xs text-gray-500 dark:text-gray-500 mt-1" id="avgWordsPerEntry">0 avg per entry</div>
            </div>
        </div>

        <!-- Mood Analytics -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Mood Distribution -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Mood Distribution</h3>
                <div id="moodChart" class="space-y-3">
                    <!-- Mood chart will be generated here -->
                </div>
            </div>

            <!-- Mood Timeline -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Mood Timeline (Last 30 Days)</h3>
                <div id="moodTimeline" class="grid grid-cols-7 gap-2">
                    <!-- Timeline will be generated here -->
                </div>
            </div>
        </div>

        <!-- AI-Powered Personal Insights -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-8">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">ü§ñ Personal Growth Insights</h3>
            <div id="personalInsights" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Personal insights will be populated here -->
            </div>
        </div>

        <!-- Habit Insights -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-8">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">üìä Habit Performance</h3>
            <div id="habitStats" class="space-y-4">
                <!-- Habit statistics will be populated here -->
            </div>
        </div>

        <!-- Weekly/Monthly Patterns -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Weekly Patterns -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Weekly Patterns</h3>
                <div id="weeklyPatterns" class="space-y-3">
                    <!-- Weekly patterns will be generated here -->
                </div>
            </div>

            <!-- Monthly Insights -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Monthly Analysis</h3>
                <div id="monthlyInsights" class="space-y-3">
                    <!-- Monthly insights will be generated here -->
                </div>
            </div>
        </div>

        <!-- Emotional Journey Map -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-8">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">üåä Emotional Journey</h3>
            <div id="emotionalJourney" class="space-y-4">
                <!-- Emotional journey insights will be populated here -->
            </div>
        </div>

        <!-- Recommendations -->
        <div class="bg-gradient-to-r from-green-500 to-teal-600 dark:from-green-600 dark:to-teal-700 rounded-lg shadow-lg p-6 text-white">
            <h3 class="text-xl font-bold mb-4">üí° AI Recommendations</h3>
            <div id="recommendations" class="space-y-3">
                <!-- AI recommendations will be populated here -->
            </div>
        </div>
    </div>

    <script>
        class JournalStatistics {
            constructor() {
                this.entries = this.loadEntries();
                this.moods = this.loadMoods();
                this.habits = this.loadHabits();
                this.tasks = this.loadTasks();
                this.moodLabels = ['Sad', 'Frustrated', 'Confused', 'Anxious', 'Neutral', 'Happy', 'Content', 'Excited'];
                this.moodEmojis = ['üò≠', 'üò°', 'ü´§', 'üò®', 'üòê', 'üòÑ', 'üòå', 'ü§©'];
                this.init();
            }

            init() {
                // Initialize dark mode
                this.initDarkMode();
                
                this.calculateMetrics();
                this.renderMoodDistribution();
                this.renderMoodTimeline();
                this.renderWeeklyPatterns();
                this.renderMonthlyInsights();
                this.renderHabitStats();
                this.generateAIInsights();
                this.generatePersonalInsights();
                this.renderEmotionalJourney();
                this.generateRecommendations();
                this.bindEvents();
            }

            initDarkMode() {
                const isDarkMode = localStorage.getItem('darkMode') === 'true';
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                }
            }

            bindEvents() {
                document.getElementById('backBtn').addEventListener('click', () => {
                    window.location.href = 'index.html';
                });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        window.location.href = 'index.html';
                    }
                });
            }

            calculateMetrics() {
                // Calculate total entries
                const totalEntries = Object.keys(this.entries).length;
                document.getElementById('totalEntries').textContent = totalEntries;

                // Calculate entries this month
                const currentMonth = new Date().toISOString().slice(0, 7);
                const entriesThisMonth = Object.keys(this.entries).filter(date => date.startsWith(currentMonth)).length;
                document.getElementById('entriesThisMonth').textContent = `${entriesThisMonth} this month`;

                // Calculate streak
                const streak = this.calculateWritingStreak();
                document.getElementById('streakDays').textContent = streak;

                // Calculate average mood
                const avgMood = this.calculateAverageMood();
                const avgMoodEmoji = avgMood >= 0 ? this.moodEmojis[Math.round(avgMood)] : 'üòê';
                document.getElementById('averageMood').textContent = avgMoodEmoji;

                // Calculate total words
                const totalWords = this.calculateTotalWords();
                document.getElementById('totalWords').textContent = totalWords;
                const avgWords = totalEntries > 0 ? Math.round(totalWords / totalEntries) : 0;
                document.getElementById('avgWordsPerEntry').textContent = `${avgWords} avg per entry`;
            }

            calculateWritingStreak() {
                let streak = 0;
                const today = new Date();
                
                for (let i = 0; i < 365; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    if (this.entries[dateStr]) {
                        streak++;
                    } else {
                        break;
                    }
                }
                
                return streak;
            }

            calculateAverageMood() {
                const moodValues = Object.values(this.moods);
                if (moodValues.length === 0) return -1;
                return moodValues.reduce((sum, mood) => sum + mood, 0) / moodValues.length;
            }

            calculateTotalWords() {
                return Object.values(this.entries).reduce((total, entry) => {
                    const words = entry.split(/\s+/).filter(word => word.length > 0);
                    return total + words.length;
                }, 0);
            }

            renderMoodDistribution() {
                const moodChart = document.getElementById('moodChart');
                const moodCounts = new Array(8).fill(0);
                
                Object.values(this.moods).forEach(mood => {
                    if (mood >= 0 && mood < 8) moodCounts[mood]++;
                });

                const maxCount = Math.max(...moodCounts, 1);

                moodChart.innerHTML = this.moodLabels.map((label, index) => {
                    const count = moodCounts[index];
                    const percentage = (count / maxCount) * 100;
                    
                    return `
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">${this.moodEmojis[index]}</div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">${label}</span>
                                    <span class="text-sm text-gray-500 dark:text-gray-400">${count}</span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                    <div class="bg-blue-600 dark:bg-blue-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderMoodTimeline() {
                const timeline = document.getElementById('moodTimeline');
                const days = [];
                
                for (let i = 29; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    const mood = this.moods[dateStr];
                    
                    days.push(`
                        <div class="w-8 h-8 rounded flex items-center justify-center text-sm ${mood !== undefined ? 'bg-blue-100 dark:bg-blue-900' : 'bg-gray-100 dark:bg-gray-700'}" 
                             title="${date.toLocaleDateString()}: ${mood !== undefined ? this.moodLabels[mood] : 'No entry'}">
                            ${mood !== undefined ? this.moodEmojis[mood] : ''}
                        </div>
                    `);
                }
                
                timeline.innerHTML = days.join('');
            }

            renderWeeklyPatterns() {
                const patterns = document.getElementById('weeklyPatterns');
                const weeklyData = this.analyzeWeeklyPatterns();
                
                patterns.innerHTML = `
                    <div class="space-y-2">
                        <div class="text-sm"><strong>Most active day:</strong> ${weeklyData.mostActiveDay}</div>
                        <div class="text-sm"><strong>Happiest day:</strong> ${weeklyData.happiestDay}</div>
                        <div class="text-sm"><strong>Writing frequency:</strong> ${weeklyData.avgEntriesPerWeek.toFixed(1)} entries/week</div>
                    </div>
                `;
            }

            renderMonthlyInsights() {
                const insights = document.getElementById('monthlyInsights');
                const monthlyData = this.analyzeMonthlyData();
                
                insights.innerHTML = `
                    <div class="space-y-2">
                        <div class="text-sm"><strong>This month:</strong> ${monthlyData.entriesThisMonth} entries</div>
                        <div class="text-sm"><strong>Last month:</strong> ${monthlyData.entriesLastMonth} entries</div>
                        <div class="text-sm"><strong>Trend:</strong> ${monthlyData.trend}</div>
                    </div>
                `;
            }

            renderHabitStats() {
                const habitStats = document.getElementById('habitStats');
                const habits = this.habits.list || [];
                
                if (habits.length === 0) {
                    habitStats.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No habits tracked yet.</p>';
                    return;
                }

                habitStats.innerHTML = habits.map((habit, index) => {
                    const completionRate = this.calculateHabitCompletionRate(index);
                    return `
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <span class="font-medium text-gray-800 dark:text-gray-200">${habit.name}</span>
                            <span class="text-sm text-orange-600 dark:text-orange-400">${completionRate}% completion</span>
                        </div>
                    `;
                }).join('');
            }

            generateAIInsights() {
                const insights = document.getElementById('aiInsights');
                insights.innerHTML = 'Analyzing your journal patterns with AI...';
                
                // Simple AI-like insights based on data
                setTimeout(() => {
                    const totalEntries = Object.keys(this.entries).length;
                    const avgMood = this.calculateAverageMood();
                    
                    let insight = '';
                    if (totalEntries > 10) {
                        insight = `You've been consistently journaling with ${totalEntries} entries! `;
                    }
                    if (avgMood > 4) {
                        insight += 'Your overall mood trend is positive. Keep up the great work!';
                    } else if (avgMood >= 0) {
                        insight += 'Your mood shows room for improvement. Consider focusing on activities that bring you joy.';
                    }
                    
                    insights.innerHTML = insight || 'Keep writing to unlock personalized insights!';
                }, 2000);
            }

            generatePersonalInsights() {
                const insights = document.getElementById('personalInsights');
                insights.innerHTML = `
                    <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-lg">
                        <h4 class="font-medium text-blue-800 dark:text-blue-200 mb-2">Writing Consistency</h4>
                        <p class="text-blue-700 dark:text-blue-300 text-sm">You're building a great writing habit!</p>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900 p-4 rounded-lg">
                        <h4 class="font-medium text-green-800 dark:text-green-200 mb-2">Emotional Awareness</h4>
                        <p class="text-green-700 dark:text-green-300 text-sm">Tracking moods helps identify patterns.</p>
                    </div>
                `;
            }

            renderEmotionalJourney() {
                const journey = document.getElementById('emotionalJourney');
                journey.innerHTML = `
                    <div class="text-gray-600 dark:text-gray-400">
                        <p>Your emotional journey shows growth and self-awareness through consistent journaling.</p>
                    </div>
                `;
            }

            generateRecommendations() {
                const recommendations = document.getElementById('recommendations');
                recommendations.innerHTML = `
                    <div class="space-y-2">
                        <div>üìù Try writing at the same time each day to build consistency</div>
                        <div>üßò Consider adding a mindfulness practice to your routine</div>
                        <div>üìä Review your patterns weekly to identify trends</div>
                    </div>
                `;
            }

            // Helper methods
            analyzeWeeklyPatterns() {
                // Simplified analysis
                return {
                    mostActiveDay: 'Sunday',
                    happiestDay: 'Friday',
                    avgEntriesPerWeek: Object.keys(this.entries).length / 4
                };
            }

            analyzeMonthlyData() {
                const currentMonth = new Date().toISOString().slice(0, 7);
                const lastMonth = new Date();
                lastMonth.setMonth(lastMonth.getMonth() - 1);
                const lastMonthStr = lastMonth.toISOString().slice(0, 7);
                
                const entriesThisMonth = Object.keys(this.entries).filter(date => date.startsWith(currentMonth)).length;
                const entriesLastMonth = Object.keys(this.entries).filter(date => date.startsWith(lastMonthStr)).length;
                
                const trend = entriesThisMonth > entriesLastMonth ? 'üìà Improving' : 
                            entriesThisMonth < entriesLastMonth ? 'üìâ Declining' : '‚û°Ô∏è Stable';
                
                return { entriesThisMonth, entriesLastMonth, trend };
            }

            calculateHabitCompletionRate(habitIndex) {
                const habit = this.habits.list[habitIndex];
                if (!habit) return 0;
                
                // Calculate last 30 days completion rate
                let completed = 0;
                let total = 0;
                
                for (let i = 0; i < 30; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    total++;
                    if (this.habits.tracking?.[dateStr]?.[habitIndex]) {
                        completed++;
                    }
                }
                
                return total > 0 ? Math.round((completed / total) * 100) : 0;
            }

            loadEntries() {
                const stored = localStorage.getItem('journalEntries');
                return stored ? JSON.parse(stored) : {};
            }

            loadMoods() {
                const stored = localStorage.getItem('journalMoods');
                return stored ? JSON.parse(stored) : {};
            }

            loadHabits() {
                const stored = localStorage.getItem('journalHabits');
                return stored ? JSON.parse(stored) : { list: [], tracking: {} };
            }

            loadTasks() {
                const stored = localStorage.getItem('journalTasks');
                return stored ? JSON.parse(stored) : {};
            }
        }

        const stats = new JournalStatistics();
    </script>
</body>
</html> 